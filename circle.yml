machine:
  timezone: Europe/London
  python:
    version: 2.7.12

dependencies:
  cache_directories:
    - "/opt/circleci/.pyenv/versions/2.7.9/lib"

database:
  override:
    - mysql -u ubuntu circle_test < tests/testdata/dbschema.sql

checkout:
  post:
    - pip install -r test-requirements.txt
    #mysql-connector is not available in pip. grrrrr.
    - curl http://cdn.mysql.com//Downloads/Connector-Python/mysql-connector-python-2.1.4.tar.gz > /tmp/mysql-connector-python-2.1.4.tar.gz
    - cd /tmp; tar xvzf mysql-connector-python-2.1.4.tar.gz
    - cd /tmp/mysql-connector-python-2.1.4; python ./setup.py install

test:
  override:
    - declare -x PYTHONPATH=$PWD/src; python -m unittest discover -s tests

deployment:
  master:
    branch: master
    commands:
      - exit 0